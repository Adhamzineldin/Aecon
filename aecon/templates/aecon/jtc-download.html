<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- Bootstrap CSS -->

  {% load staticversion %} {% load my_filters %} {% load client_tags %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
  <link rel="stylesheet" href="https://use.typekit.net/qhi7zfc.css" />
  <link rel="stylesheet" type="text/css"
	href="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.css" />
  <link rel="stylesheet" type="text/css" href="/static/aecon/daterangepicker.css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
	integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/leaflet.awesome-markers.css' %}" type="text/css" />
  {% if DEBUG %}
  <link rel="stylesheet" href="/static/media/icons/font-packs/style.css" type="text/css" />
  {% else %}
  <link rel="stylesheet" href="/static/media/icons/font-packs/style.css" type="text/css" />
  {% endif %}
  <link rel="stylesheet" href="{% staticversion 'aecon/nouislider.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/cv2-base.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/bootstrap.min.css' %}" />
  <link rel="stylesheet" href="{% staticversion 'aecon/checkbox-style.css' %}" type="text/css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <script src="https://mapbox.github.io/geojson-vt/geojson-vt-dev.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" />
  <script type="text/javascript" src="/static/aecon/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"
	integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig=="
	crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://d3js.org/d3.v3.js"></script>
  <script src="https://mapbox.github.io/geojson-vt/geojson-vt-dev.js"></script>

  <script src="{% staticversion 'aecon/leaflet.polylineDecorator.js' %}"></script>
  <script src="{% staticversion 'aecon/L.Line3.js' %}"></script>
  <script src="{% staticversion 'aecon/nouislider.js' %}"></script>
  <script src="{% staticversion 'aecon/leaflet.lineextremities.js' %}"></script>

  <script src="{% staticversion 'aecon/bootstrap.bundle.min.js' %}"></script>
  <script src="{% staticversion 'aecon/cv2-data-func.js' %}"></script>

  <script src="{% staticversion 'aecon/cv2-map.js' %}"></script>
  <script src="{% staticversion 'aecon/atc.js' %}"></script>
  <script src="{% staticversion 'aecon/cv2-main.js' %}"></script>
 
  <link rel="stylesheet" href="/static/aecon/jtc/filters.css" />
  <link rel="stylesheet" href="/static/aecon/jtc/sidebar.css" />
  <link rel="stylesheet" href="/static/aecon/jtc/jtc.css" />
  <title>Tracsis AECON</title>
</head>

<body>
	<style>
		* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
		}

		body {
		background: #fff;
		{% comment %} overflow-x: hidden; {% endcomment %}
		}

		.modal,
		.modal-backdrop {
		position: absolute !important;
		}

		.modal-dialog {
		max-width: 90% !important;
		}

		.modal-dialog,
		.modal-content {
		/* 80% of window height */
		height: 90%;
		}

		.modal-body {
		/* 100% = dialog height, 120px = header + footer */
		overflow: hidden;
		}

		.footer-bottom div {
		background: #141b4d;
		}

		.footer-bottom p {
		float: left;
		font-size: 14px;
		word-spacing: 2px;
		text-transform: capitalize;
		}

		.footer-bottom p img {
		justify-content: center;
		}

		.footer-bottom span {
		text-transform: uppercase;
		opacity: 0.4;
		font-weight: 200;
		}

		.footer-menu {
		float: right;
		}

		.footer-menu ul {
		display: flex;
		}

		.footer-menu ul li {
		padding-right: 10px;
		display: block;
		}

		.footer-menu ul li a {
		color: #fff;
		text-decoration: none;
		background-color: #ffffff;
		}

		.footer-menu ul li a:hover {
		color: #fff;
		}

		.socials {
		list-style: none;
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 0px;
		}

		.socials a {
		text-decoration: none;
		color: #fff;
		border: 1.1px solid white;
		padding: 5px;
		border-radius: 50%;
		}

		.socials a i {
		font-size: 1.1rem;
		width: 18px;
		transition: color 0.4s ease;
		text-align: center;
		color: #141b4d;
		}

		.socials a:hover i {
		color: #141b4d;
		}

		.footer {
		height: 60px;
		margin-top: 20px;
		}

		.ht-40 {
		height: 45rem !important;
		}

		.canvass .mt-5 {
		margin-top: 4rem !important;
		}

		.ht-35 {
		height: 35rem !important;
		}

		.classify th:nth-child(1) {
		width: 20% !important;
		}

		.cond-tb tr {
		background-color: #141b4d !important;
		color: white !important;
		}

		.customScroll2 {
			height: 24rem;
			overflow-x: hidden;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
			margin-bottom: 10px;
		}

	

		.project_label {
		color: #fff;
		}

		.location_label {
		color: var(--secondary);
		}

		@media (max-width: 500px) {
		.footer-menu ul {
			display: flex;
			margin-top: 10px;
			margin-bottom: 20px;
		}
		}

		.dd-search i {
			right: 27px;
			font-size: 15px;
		}
	</style>
	{% csrf_token %}
	<div class="greyed-out justify-content-center align-items-center">
		<img src="{% staticversion 'aecon/small_loading.gif' %}" class="loading-img"
		data-greyed-out="atc-basic-overview" />
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link href="/static/aecon/select2.min.css" rel="stylesheet" />
	<script src="/static/aecon/select2.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/static/aecon/moment.min.js"></script>
	<script type="text/javascript" src="/static/aecon/daterangepicker.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>

	<div class="header">
		{% include "aecon/jtc-navbar.html" %}
		{% include "aecon/jtc-subnavbar.html" %}
	</div>
	<div class="row main">
			<div class="col-md-8 text-center">
			<label class="text-left mt-5 mb-4" style="font-size: medium;margin-top: 8px;">
			<strong>Downloading Instructions:</strong>
			<br>1) Select <strong>projects</strong> from the <strong>projects list</strong> to show their associated
			Site.
			<br>2) Select <strong>Sites</strong> associated with a project from the <strong>Site list</strong> to
			download.
		</label>
		</div>
	</div>
	<div class="row main" style="margin-top: 8px">
		<div class="col-md-3">
		<label for="project_list"><strong>Projects List</strong></label>
		<input type="checkbox" id="project-select-all-check">
		<div class="customScroll2" id="projects_list">
			<div class="dd-wrapper" id="project-select-wrapper">
			<div sectionId="project-select-wrapper" class="dd-select-btn" id="project-select-btn">
				<span sectionId="project-select-wrapper">Project Name</span>
				<i sectionId="project-select-wrapper" class="fa-solid fa-chevron-down"></i>
			</div>
			<div class="dd-all-content">
				<div class="dd-content">
				<div class="dd-search">
					<i class="fa-solid fa-magnifying-glass"></i>
					<input onkeyup="filterList(this,'project')" onclick="event.stopPropagation()" spellcheck="false"
					type="text" placeholder="Search" id="project-select-input">
				</div>
				<div class="dd-options">
					<ul class="dd-options-list" id="project-select-option-list">
					</ul>
				</div>
				</div>
			</div>
			</div>
		</div>
		</div>
		<div class="col-md-4" id="locations_list"  style="margin-top: 8px">
		<label for="project_list"><strong>Locations List</strong></label>
		<input type="checkbox" id="location-select-all-check" >
			<div class="customScroll2 site-list" id="locations_list">
			</div>
		</div>
	</div>
	<div class="row main">
		<div class="col-md-3">
			<strong id="selectedProjectCount">0 Project selected</strong>
		</div>
		<div class="col-md-1">
			<strong id="selectedlocationCount">0 location selected</strong>
		</div>
	</div>
	<div class="row main">
		
		<div class="col text-center">
		<input for="download-form" type="button" class="mt-3 btn shadow my-auto" value="JTC Data Download"
			id="download-btn" />
		</div>
	</div>
</body>
<script>
	let data = {{project_locations}}
	console.log(data)
	createprojectoptionlist(data)
	var wrapperList = {
		project: "project-select-wrapper",
		site: "site-select-wrapper",
		observation: "observation-select-wrapper",
		classification: "classification-select-wrapper",
		destArm: "dest-arm-select-wrapper",
		originArm: "origin-arm-select-wrapper",
		endTime: "end-time-select-wrapper",
		startTime: "start-time-select-wrapper",
		peak: "peak-select-wrapper"
	}
	$('#jtc-download').addClass('active')
	function tabContent(type, flg = "") {
		var tab_content = {
		"headline": "jtc-headline",
		"volume": "jtc-volume",
		"overview": "jtc-overview"
		}
		var keys = Object.keys(tab_content);
		for (let i = 0; i < keys.length; i++) {
		if (type == keys[i] && type != "") {
			window.location.href = "/aecon/jtc-data/" + tab_content[keys[i]]
		}
		else if (flg != "", flg == tab_content[keys[i]]) {
			document.getElementById(keys[i]).classList.add("active");
		}
		}
	}
	function createprojectoptionlist(data){
		var html = '';
		var sitehtml = '';
		for(i=0;i<data.length;i++){
			html += '<li  class="dd-list" onclick="projectselection('+data[i].id+',this)" id='+data[i].id+' data-type="'+data[i].project_type+'">'+data[i].name+'</li>';
			for(j=0;j<data[i].sites.length;j++){
				sitehtml += '<div name="Survey 1_location_check" class="checkbox survey_site project_site_'+data[i].id+'"><input class="survey_site-checkbox"  onclick="locationselection()"   type="checkbox" name="project_site" id="project_site_'+data[i].sites[j].id+'" class="Survey 1" value="'+data[i].sites[j].id+'" ><label style="position: relative; top: 4px" for="Survey 1_1_check" class="location_label p-2"><span class="project_label">'+data[i].sites[j].name+'</span></label></div>'
			}
			$('.site-list').empty().append(sitehtml);
		}
		$('#project-select-option-list').empty().append(html);
		$('.survey_site').hide();
	}

	function projectselection(projectid,e){
		var innerTextname = []
		var innerTextID = []
		if(projectid != ''){
			var $this = $(e);
			console.log($this.hasClass('dd-isSelected'))
			if($this.hasClass('dd-isSelected')){
				$this.removeClass("dd-isSelected");
				$this.find('i').remove();
			}else{
				$this.addClass("dd-isSelected").append($("<i>").addClass("fa-solid fa-check").css({"font-size": "14px","color": "#25d125"}));
				$("#project-select-btn span").text($this.text());
				$('.project_site_'+projectid).show();
				$('#project-select-wrapper').removeClass('active');
			}
				
		}
			
		document.querySelectorAll("#project-select-option-list li").forEach(item => {
			if(item.classList.contains("dd-isSelected")){
				innerTextname.push(item.innerText);
				innerTextID.push(item.id);
			}
		})
		$("#project-select-btn span").text(innerTextname);
		$('.survey_site').hide();
		for(i=0;i<innerTextID.length;i++){
			$('.project_site_'+innerTextID[i]).show();
		}
		
		var selectedproject = 0;
		document.querySelectorAll("#project-select-option-list li.dd-isSelected").forEach(item => {
			selectedproject = selectedproject + 1;
		});
		$('#selectedProjectCount').text(selectedproject + ' Project selected')
	}
	
	document.getElementById("project-select-btn").addEventListener("click", (e) => {
		e.stopPropagation()
		Object.keys(wrapperList).forEach(item => {
			if (item == "project") {
				document.getElementById(wrapperList[item]).classList.toggle("active")
			} 
		})
	});
	
	$("#download-btn").on("click", function() {
		let formData = new FormData()
		var checkedsiteValues = $('.survey_site-checkbox:visible:checked').map(function() {
			return this.value;
		}).get()
		let is_turning_count = false //(localStorage.getItem("jtc_toggler") && localStorage.getItem("jtc_toggler") == "true")
		var selectedproject_id = $("#project-select-option-list li.dd-isSelected").attr("id");
		formData.append("project_id",selectedproject_id)
		formData.append('location_id', checkedsiteValues);
		formData.append('is_turning_count', is_turning_count);
		return fetcher(formData, "jtc-download", function (response) {
			jtc_data = response;
			if(jtc_data.status == 'sucess'){
				alert('Your download Process has started, An email with a link to your download will be sent shortly!');
			}
		})
	});

	$("#location-select-all-check").on("click", function(e) {
		if(e.target.checked){
			$('.survey_site-checkbox').prop('checked', true);
		}else{
			$('.survey_site-checkbox').prop('checked', false);
		}
		locationselection();
	});

	$("#project-select-all-check").on("click", function(e) {
		let jtc_toggler =  false //(localStorage.getItem('jtc_toggler') && localStorage.getItem('jtc_toggler') == 'true')
		let pro_type = 'JTC'; //jtc_toggler ? 'Turning Counts' : 'JTC';
		if(e.target.checked){
			document.querySelectorAll(`#project-select-option-list [data-type="${pro_type}"]`).forEach(item => {
				item.classList.remove("dd-isSelected");
				const checkIcon1 = item.querySelector("i");
				if (checkIcon1) {
					item.removeChild(checkIcon1);
				}

				const checkIcon = document.createElement("i");
				checkIcon.className = "fa-solid fa-check";
				checkIcon.style.fontSize = "14px";
				checkIcon.style.color = "#25d125";
				item.classList.add("dd-isSelected");
				item.appendChild(checkIcon);
				
			})
			projectselection('')
		}else{
			document.querySelectorAll(`#project-select-option-list [data-type="${pro_type}"]`).forEach(item => {
				item.classList.remove("dd-isSelected");
				const checkIcon = item.querySelector("i");
				if (checkIcon) {
					item.removeChild(checkIcon);
				}
			});
			$("#project-select-btn span").text('Project Name');
			$('.survey_site').hide();
		}
		var selectedproject = 0;
		document.querySelectorAll("#project-select-option-list li.dd-isSelected").forEach(item => {
			selectedproject = selectedproject + 1;
		});
		$('#selectedProjectCount').text(selectedproject + ' Project selected')
	});

	function filterList(eve, sec) {
		document.querySelectorAll("#project-select-option-list li").forEach(item => {
			const inputValue = eve.value.toLowerCase();
			const itemText = item.innerText.toLowerCase();
			
			if (!itemText.startsWith(inputValue)) {
				item.classList.add("d-none");
			} else {
				item.classList.remove("d-none");
			}
		});
		
	}
	function locationselection(){
		$('#selectedlocationCount').text($('.survey_site-checkbox:visible:checked').length + ' location selected')
	}

	// if (localStorage.getItem("jtc_toggler") && localStorage.getItem("jtc_toggler") == "true"){
	// 	$('#overview').hide();
	// 	$('#project-select-option-list [data-type=JTC]').hide()
	// 	$('#jtc-upload').attr('onclick', "location.href = '/aecon/jtc-turning-count-upload';");
	// 	}
	// 	else{
			$('#overview').hide();
			$('#project-select-option-list [data-type="Turning Counts"]').hide();
			$('#jtc-upload').attr('onclick', "location.href = '/aecon/jtc-upload';");
	// }
	
</script>

</html>