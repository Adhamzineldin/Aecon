<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- Bootstrap CSS -->

  {% load staticversion %} {% load my_filters %} {% load client_tags %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  <link rel="stylesheet" href="https://use.typekit.net/qhi7zfc.css">
  <link rel="stylesheet" type="text/css"
    href="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.css" />
  <link rel="stylesheet" type="text/css" href="/static/aecon/daterangepicker.css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
    integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/leaflet.awesome-markers.css' %}" type="text/css" />
  {% if DEBUG %}
  <link rel="stylesheet" href="/static/media/icons/font-packs/style.css" type="text/css" />
  {% else %}
  <link rel="stylesheet" href="/static/media/icons/font-packs/style.css" type="text/css" /> {% endif %}
  <link rel="stylesheet" href="{% staticversion 'aecon/nouislider.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/cv2-base.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/bootstrap.min.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% staticversion 'aecon/checkbox-style.css' %}" type="text/css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <script src="https://mapbox.github.io/geojson-vt/geojson-vt-dev.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" />
  <script type="text/javascript" src="/static/aecon/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://d3js.org/d3.v3.js"></script>
  <script src="https://mapbox.github.io/geojson-vt/geojson-vt-dev.js"></script>
  <script src="{% staticversion 'aecon/leaflet.polylineDecorator.js' %}"></script>
  <script src="{% staticversion 'aecon/L.Line3.js' %}"></script>
  <script src="{% staticversion 'aecon/nouislider.js' %}"></script>
  <script src="{% staticversion 'aecon/leaflet.lineextremities.js' %}"></script>
  <script src="{% staticversion 'aecon/cv2-data-func.js' %}"></script>
  <script src="{% staticversion 'aecon/cv2-map.js' %}"></script>
  <script src="{% staticversion 'aecon/atc.js' %}"></script>
  <script src="{% staticversion 'aecon/cv2-main.js' %}"></script>
  <title>Tracsis AECON</title>
  <style>
    .progress-bar {
      background-color: #141b4d;
    }

    #success-message h3 {
      margin-bottom: 1rem;
    }

    #success-message {
      display: none;
    }

    #file-uploading-reset {
      background-color: #141b4d;
      color: #ffff;
      display: none;
      margin-top: 1rem;
    }

    #text-area {
      overflow-x: auto;
      height: 10rem;
      margin: auto;
      width: 50%;
      border: 1px solid black;
      text-align: left;
      padding: 1rem;
      border-radius: 5px;
    }

    #text-area p {
      margin-top: 0;
      margin-bottom: 0;
    }
    .carousel-control-next-icon, .carousel-control-prev-icon {
      -webkit-filter: none;
      filter: none;
  }
  .carousel-control-prev {
    left: 175px;
    opacity: unset;
}
.carousel-control-next {
  right: 175px;
  opacity: unset;
}
@media only screen and (max-device-width: 1550px) {
  .carousel-control-prev {
    left: 100px;
}
.carousel-control-next {
  right: 100px;
}
}
@media only screen and (max-device-width: 1320px) {
  .carousel-control-prev {
    left: -50px;
}
.carousel-control-next {
  right: -50px;
}
}
@media only screen and (max-device-width: 930px) {
  .carousel-control-prev {
    left: -80px;
}
.carousel-control-next {
  right: -80px;
}
}
  </style>
</head>

<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/static/aecon/moment.min.js"></script>
  <script type="text/javascript" src="/static/aecon/daterangepicker.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>

  <div class="header">
    {% include "aecon/jtc-navbar.html" %}
    {% include "aecon/jtc-subnavbar.html" %}
  </div>

  <div class="row main" style="margin-top: 15px">
    <div class="col-md-11 mb-3 mt-4">
      <div class="form-group text-center" id="upload-input">
        <label class="input-labels text-left" style="font-size: medium;margin-bottom: 15px">
          <strong>Uploading Instructions:</strong>
          <br>1) Please make sure all the direction for the location are provided based on the template.
          <br>2) Please make sure each file have information for one location</strong>
          <br>3) <a href="/static/aecon/jtc/turning_counts_format.xlsx" >Click here</a> to download the template for temp sensor.
          <br><br><strong>Please Note: the upload process is done in batches of 5 files per batch. And when a batch
            upload is completed, an email with the 5 uploaded files' names is sent.</strong>
        </label>
        <div class="text-center">
          <div id="demo" class="carousel slide" data-ride="carousel">
          {% comment %} <div class="carousel-indicators">
            <button type="button" data-target="#demo" data-slide-to="0" class="active"></button>
            <button type="button" data-target="#demo" data-slide-to="1"></button>
            <button type="button" data-target="#demo" data-slide-to="2"></button>
          </div> {% endcomment %}
          
          <!-- The slideshow/carousel -->
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img   src="/static/aecon/turning_count_img_1.png"  height="400px"  width="800px">
            </div>
            <div class="carousel-item">
              <img  src="/static/aecon/turning_count_img_2.png"   height="400px"   width="800px">
            </div>
          </div>
          
          <!-- Left and right controls/icons -->
          <button class="carousel-control-prev" type="button" data-target="#demo" data-slide="prev">
            <span class="carousel-control-prev-icon"><img src="/static/aecon/prev.png" style="width: 25px;"></span>
          </button>
          <button class="carousel-control-next" type="button" data-target="#demo" data-slide="next">
            <span class="carousel-control-next-icon"><img src="/static/aecon/next.png" style="width: 25px;"></span>
          </button>
        </div>
          {% comment %} <img height="50" width="800" class="h-75" src="/static/aecon/jtc_upload_file_Template_1.png" alt="CSV" style="width: 40%">
          <img height="50" width="800" class="h-75" src="/static/aecon/jtc_upload_file_Template_2.png" alt="CSV" style="width: 40%">
          <img height="50" width="800" class="h-75" src="/static/aecon/jtc_upload_file_Template_3.png" alt="CSV" style="width: 40%"> {% endcomment %}
        </div>
        <form class="text-center mt-4" method="POST" enctype="multipart/form-data" id="upload-form">
          {% csrf_token %}
          <label for="input-upload" class="btn shadow my-auto mx-1" id="upload-button">Temp Data Upload</label>
          <input type="file" name="document" id="input-upload" style="display: none;" multiple>
          <!-- <input type="file" name="document" id="input-upload" style="display: none;" webkitdirectory directory multiple> -->
        </form>
        <div id="status-message" style="display: none;">
          <div id="success-message">
            <h3 style="margin-bottom: 1rem;">File Uploading Successfully</h3>
          </div>
          <div class=" progress mb-4 w-75 m-auto" d-none>
            <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%" role="progressbar"
              aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">0%</div>
          </div>
          <div>
            <div id="text-area">
              <p>File Uploading...</p>
            </div>
          </div>
          <button onclick="uploadFileReset()" type="button" class="btn" id="file-uploading-reset">Reset</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    $('#jtc-upload').addClass('active')
    $('#overview').hide();
    if(localStorage.getItem("uploadToken")){
      checkFileUploadStatus(localStorage.getItem("uploadToken"), 'upload-button', "status-message")
    }
    function tabContent(type, flg = "") {
      var tab_content = {
        "headline": "jtc-headline",
        "volume": "jtc-volume",
        "overview": "jtc-overview"
      }
      var keys = Object.keys(tab_content);
      for (let i = 0; i < keys.length; i++) {
        if (type == keys[i] && type != "") {
          window.location.href = "/aecon/jtc-data/" + tab_content[keys[i]]
        }
        else if (flg != "", flg == tab_content[keys[i]]) {
          document.getElementById(keys[i]).classList.add("active");
        }
      }
    }
    document.getElementById("input-upload").onchange = function () {
      var uploaded_files = document.getElementById("input-upload").files;
      var project_name = uploaded_files[0].name.split(/[_\s]+/)[0];
      if (uploaded_files.length <= 50) {
        var form = document.getElementById('upload-form');
        var formData = new FormData(form);
        
        fetcher(formData, "jtc-turning-count-upload", function (result) {
          
          localStorage.setItem("uploadToken",result.token)
          checkFileUploadStatus(result.token, 'upload-button', "status-message")
          form.reset()
        });


        alert("Upload started\nNumber of files are: " + uploaded_files.length + "\nproject number is: " + project_name);
      }
      else {
        alert("Upload Failed\nNumber of files exceeds the file upload limit\nPlease make sure that the folder contains 50 files or less");
      }
    }

    function uploadFileReset() {
      document.querySelector("#status-message .progress-bar").style.width = "0%"
      document.querySelector("#status-message .progress-bar").innerText = "0%"
      document.querySelector("#status-message #text-area").innerHTML = "<p>File Uploading...</p>"
      $("#upload-button").show()
      $("#status-message").hide()
      $("#success-message").hide()
      $("#file-uploading-reset").hide()
    }
  </script>
</body>

</html>